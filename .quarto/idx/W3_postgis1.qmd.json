{"title":"Spatial SQL I","markdown":{"headingText":"Spatial SQL I","containsRefs":false,"markdown":"\n## Introduction\n\nIn this lesson, you will learn how to use SQL to query spatial data. You will learn how to use the `duckdb` Python library to connect to a DuckDB database and run SQL queries. You will also learn how to use the `leafmap` Python library to visualize spatial data.\n\n## Learning Objectives\n\nBy the end of this lesson, you will be able to:\n\n- Connect to a DuckDB database using Python\n- Run SQL queries to query spatial data\n- Visualize spatial data using Leafmap\n- Run spatial SQL queries using PgAdmin\n\n## Materials \n\nTo get started, work your way through the following two notebooks:\n\n1. [Geometries](https://colab.research.google.com/github/oballinger/CASA0025/blob/main/notebooks/W03_geometries.ipynb)\n2. [Spatial Relationships](https://colab.research.google.com/github/oballinger/CASA0025/blob/main/notebooks/W03_spatial_relationships.ipynb)\n\nClicking the link will take you to Google Colab, where you can run the notebook in your browser. These workbooks use the `duckdb` Python library to connect to a DuckDB database and run SQL queries. They also use the `leafmap` Python library to visualize spatial data. Most of the spatial functions and syntax are the same or very similar to their PostGIS equivalents.\n\nOnce you've completed these you can test your knowledge by answering the questions in the lab below. To complete this lab, open PgAdmin and connect to the `nyc` database. Then, open a new query window and write your SQL queries there.\n\n# Geometry Exercises\n\nHere\\'s a reminder of all the functions we have seen so far. They should\nbe useful for the exercises!\n\n-   `sum(expression)`{.interpreted-text role=\"command\"} aggregate to\n    return a sum for a set of records\n-   `count(expression)`{.interpreted-text role=\"command\"} aggregate to\n    return the size of a set of records\n-   `ST_GeometryType(geometry)`{.interpreted-text role=\"command\"}\n    returns the type of the geometry\n-   `ST_NDims(geometry)`{.interpreted-text role=\"command\"} returns the\n    number of dimensions of the geometry\n-   `ST_SRID(geometry)`{.interpreted-text role=\"command\"} returns the\n    spatial reference identifier number of the geometry\n-   `ST_X(point)`{.interpreted-text role=\"command\"} returns the X\n    ordinate\n-   `ST_Y(point)`{.interpreted-text role=\"command\"} returns the Y\n    ordinate\n-   `ST_Length(linestring)`{.interpreted-text role=\"command\"} returns\n    the length of the linestring\n-   `ST_StartPoint(geometry)`{.interpreted-text role=\"command\"} returns\n    the first coordinate as a point\n-   `ST_EndPoint(geometry)`{.interpreted-text role=\"command\"} returns\n    the last coordinate as a point\n-   `ST_NPoints(geometry)`{.interpreted-text role=\"command\"} returns the\n    number of coordinates in the linestring\n-   `ST_Area(geometry)`{.interpreted-text role=\"command\"} returns the\n    area of the polygons\n-   `ST_NRings(geometry)`{.interpreted-text role=\"command\"} returns the\n    number of rings (usually 1, more if there are holes)\n-   `ST_ExteriorRing(polygon)`{.interpreted-text role=\"command\"} returns\n    the outer ring as a linestring\n-   `ST_InteriorRingN(polygon, integer)`{.interpreted-text\n    role=\"command\"} returns a specified interior ring as a linestring\n-   `ST_Perimeter(geometry)`{.interpreted-text role=\"command\"} returns\n    the length of all the rings\n-   `ST_NumGeometries(multi/geomcollection)`{.interpreted-text\n    role=\"command\"} returns the number of parts in the collection\n-   `ST_GeometryN(geometry, integer)`{.interpreted-text role=\"command\"}\n    returns the specified part of the collection\n-   `ST_GeomFromText(text)`{.interpreted-text role=\"command\"} returns\n    `geometry`\n-   `ST_AsText(geometry)`{.interpreted-text role=\"command\"} returns WKT\n    `text`\n-   `ST_AsEWKT(geometry)`{.interpreted-text role=\"command\"} returns EWKT\n    `text`\n-   `ST_GeomFromWKB(bytea)`{.interpreted-text role=\"command\"} returns\n    `geometry`\n-   `ST_AsBinary(geometry)`{.interpreted-text role=\"command\"} returns\n    WKB `bytea`\n-   `ST_AsEWKB(geometry)`{.interpreted-text role=\"command\"} returns EWKB\n    `bytea`\n-   `ST_GeomFromGML(text)`{.interpreted-text role=\"command\"} returns\n    `geometry`\n-   `ST_AsGML(geometry)`{.interpreted-text role=\"command\"} returns GML\n    `text`\n-   `ST_GeomFromKML(text)`{.interpreted-text role=\"command\"} returns\n    `geometry`\n-   `ST_AsKML(geometry)`{.interpreted-text role=\"command\"} returns KML\n    `text`\n-   `ST_AsGeoJSON(geometry)`{.interpreted-text role=\"command\"} returns\n    JSON `text`\n-   `ST_AsSVG(geometry)`{.interpreted-text role=\"command\"} returns SVG\n    `text`\n\nAlso remember the tables we have available:\n\n-   `nyc_census_blocks`\n    -   blkid, popn_total, boroname, geom\n-   `nyc_streets`\n    -   name, type, geom\n-   `nyc_subway_stations`\n    -   name, geom\n-   `nyc_neighborhoods`\n    -   name, boroname, geom\n\n## Exercises\n\n-   **What is the area of the \\'West Village\\' neighborhood?** (Hint: The area is given in square meters. To get an area in hectares, divide by 10000. To get an area in acres, divide by 4047.)\n-   **What is the geometry type of 'Pelham St'? The length?**\n\n-   **What is the GeoJSON representation of the \\'Broad St\\' subway\n    station?**\n\n-   **What is the total length of streets (in kilometers) in New York\n    City?** (Hint: The units of measurement of the spatial data are\n    meters, there are 1000 meters in a kilometer.)\n\n-   **What is the area of Manhattan in acres?** (Hint: both\n    `nyc_census_blocks` and `nyc_neighborhoods` have a `boroname` in\n    them.)\n\n-   **What is the most westerly subway station?**\n\n-   **How long is \\'Columbus Cir\\' (aka Columbus Circle)?**\n\n-   **What is the length of streets in New York City, summarized by\n    type?**\n\n[Answers](https://postgis.net/workshops/postgis-intro/geometries_exercises.html) (only check after you've given it your best shot!)\n\n# Spatial Relationships Exercises\n\nHere\\'s a reminder of the functions we saw in the last section. They should be useful for the exercises!\n\n-   `sum(expression)`{.interpreted-text role=\"command\"} aggregate to\n    return a sum for a set of records\n-   `count(expression)`{.interpreted-text role=\"command\"} aggregate to\n    return the size of a set of records\n-   `ST_Contains(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A contains geometry B\n-   `ST_Crosses(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A crosses geometry B\n-   `ST_Disjoint(geometry A , geometry B)`{.interpreted-text\n    role=\"command\"} returns true if the geometries do not \\\"spatially\n    intersect\\\"\n-   `ST_Distance(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns the minimum distance between geometry A and\n    geometry B\n-   `ST_DWithin(geometry A, geometry B, radius)`{.interpreted-text\n    role=\"command\"} returns true if geometry A is radius distance or\n    less from geometry B\n-   `ST_Equals(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A is the same as geometry B\n-   `ST_Intersects(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A intersects geometry B\n-   `ST_Overlaps(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A and geometry B share\n    space, but are not completely contained by each other.\n-   `ST_Touches(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if the boundary of geometry A touches\n    geometry B\n-   `ST_Within(geometry A, geometry B)`{.interpreted-text\n    role=\"command\"} returns true if geometry A is within geometry B\n\nAlso remember the tables we have available:\n\n-   `nyc_census_blocks`\n    -   blkid, popn_total, boroname, geom\n-   `nyc_streets`\n    -   name, type, geom\n-   `nyc_subway_stations`\n    -   name, geom\n-   `nyc_neighborhoods`\n    -   name, boroname, geom\n\n## Exercises\n\n-   **What is the geometry value for the street named \\'Atlantic Commons\\'?**\n\n-   **What neighborhood and borough is Atlantic Commons in?**\n\n-   **What streets does Atlantic Commons join with?**\n\n-   **Approximately how many people live on (within 50 meters of) Atlantic Commons?**\n\n[Answers](https://postgis.net/workshops/postgis-intro/spatial_relationships_exercises.html) (only check after you've given it your best shot!)\n\n# References \n\n- [Qiusheng Wu](https://geog-414.gishub.org/)\n- [PostGIS Workshop](https://postgis.net/workshops/postgis-intro/)","srcMarkdownNoYaml":""},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"wrap","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true,"format-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","highlight-style":"monokai.theme","output-file":"W3_postgis1.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.3.326","bibliography":["references.bib"],"theme":{"dark":"darkly","light":"cosmo"},"code-copy":true,"linkcolor":"#34a832"},"extensions":{"book":{"multiFile":true}}},"pdf":{"identifier":{"display-name":"PDF","target-format":"pdf","base-format":"pdf"},"execute":{"fig-width":5.5,"fig-height":3.5,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"pdf-engine":"xelatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","output-file":"W3_postgis1.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"block-headings":true,"bibliography":["references.bib"],"documentclass":"scrreprt","header-includes":["\\makeatletter","\\@addtoreset{chapter}{part}","\\makeatother"]},"extensions":{"book":{"selfContainedOutput":true}}},"epub":{"identifier":{"display-name":"ePub","target-format":"epub","base-format":"epub"},"execute":{"fig-width":5,"fig-height":4,"fig-format":"png","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"engine":"markdown"},"render":{"keep-tex":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"epub","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":true,"merge-includes":false,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"default-image-extension":"png","html-math-method":"mathml","to":"epub","output-file":"W3_postgis1.epub"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items"},"metadata":{"bibliography":["references.bib"],"cover-image":"cover.png"},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["html","pdf","epub"]}